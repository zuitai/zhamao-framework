(window.webpackJsonp=window.webpackJsonp||[]).push([[209],{890:function(e,r,a){"use strict";a.r(r);var t=a(81),s=Object(t.a)({},(function(){var e=this,r=e._self._c;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"出现-deadlock-字样"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#出现-deadlock-字样"}},[e._v("#")]),e._v(" 出现 deadlock 字样")]),e._v(" "),r("p",[e._v("一般情况下，如果误操作框架可能会报如下图的错误：")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("===================================================================\n [FATAL ERROR]: all coroutines (count: 1) are asleep - deadlock!\n===================================================================\n\n [Coroutine-1]\n--------------------------------------------------------------------\n#0  Swoole\\Coroutine\\System::sleep() called at [/Users/jerry/project/git-project/zhamao-framework/src/ZM/global_functions.php:232]\n#1  zm_sleep() called at [/Users/jerry/project/git-project/zhamao-framework/src/Module/Example/Hello.php:38]\n#2  Module\\Example\\Hello->onStart() called at [/Users/jerry/project/git-project/zhamao-framework/src/ZM/Event/EventDispatcher.php:205]\n#3  ZM\\Event\\EventDispatcher->dispatchEvent() called at [/Users/jerry/project/git-project/zhamao-framework/src/ZM/Event/EventDispatcher.php:89]\n#4  ZM\\Event\\EventDispatcher->dispatchEvents() called at [/Users/jerry/project/git-project/zhamao-framework/src/ZM/Event/SwooleEvent/OnWorkerStart.php:130]\n#5  ZM\\Event\\SwooleEvent\\OnWorkerStart->onCall() called at [/Users/jerry/project/git-project/zhamao-framework/src/ZM/Framework.php:336]\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br"),r("span",{staticClass:"line-number"},[e._v("7")]),r("br"),r("span",{staticClass:"line-number"},[e._v("8")]),r("br"),r("span",{staticClass:"line-number"},[e._v("9")]),r("br"),r("span",{staticClass:"line-number"},[e._v("10")]),r("br"),r("span",{staticClass:"line-number"},[e._v("11")]),r("br"),r("span",{staticClass:"line-number"},[e._v("12")]),r("br")])]),r("p",[e._v("这种错误的出现原因一般是因为协程未结束而 Worker 进程提前退出导致的，这个错误也可手动造成（在任意 Worker 进程内的位置使用 "),r("code",[e._v("zm_yield()")]),e._v(" 且不使用 "),r("code",[e._v("zm_resume()")]),e._v(" 恢复，期间使用 reload 或 stop 重启或停止框架就会报错）。")]),e._v(" "),r("p",[e._v("还有一种情况是数据库、文件读取或下载上传还没有传送结束，时间已经超时，在关闭或重启框架时不得不强行切断协程的运行。这种情况建议根据下方的打印输出栈进行插错，建议将协程运行时间长的过程缩短或调长 "),r("code",[e._v("swoole")]),e._v(" 配置项下面的 "),r("code",[e._v("max_wait_time")]),e._v(" 时间（秒），2.4.3 版本起此参数默认为 5 秒。")])])}),[],!1,null,null,null);r.default=s.exports}}]);